---
import Base from "../layouts/Base.astro";
import Slideshow from "../components/Slideshow.astro";
import TeamList from "../components/TeamList.astro";
import OfferList from "../components/OfferList.astro";
import PartnerList from "../components/PartnerList.astro";
import Map from "../components/Map.astro";
import SectionHeader from "../components/SectionHeader.astro";
import ContactForm from "../components/ContactForm.astro";
import RichTextContainer from "../components/RichTextContainer.astro";

import {
  getLandingPage,
  getTeamMembers,
  getOffers,
  getPartners,
  getConfigByID,
} from "../lib/API";

import { cached } from "../lib/cached";

// ðŸš€ Alle API-Aufrufe parallel und gecacht
const [landingPage, teamMembers, offers, partners, settings] = await Promise.all([
  cached("landingPage", getLandingPage),
  cached("teamMembers", getTeamMembers),
  cached("offers", getOffers),
  cached("partners", getPartners),
  cached("settings", () => getConfigByID("5eUmE4yWNEM9xNibICQaWh")),
]);

const { data } = settings;

// Metadaten fÃ¼r Base
const title = `${data.title} â€“ ${data.subtitle}`;
const description = landingPage.info || data.subtitle;
const image = landingPage.props.slideshowImages?.[0]?.fields?.file?.url || "";
const domain = data.domain;

---
<Base title={title} description={description} slug="" image={image} domain={domain} brand={`${data.prefix} ${data.owner}`}>
  <header class="w-screen h-screen relative">
    <Slideshow images={landingPage.props.slideshowImages} />
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-shadow-lg text-center">
      <h1 class="prefix lowercase text-xl font-smallCaps leading-none text-brand tracking-wider drop-shadow-lg" set:html={data.prefix} />
      <h1 class="title min-w-52 font-smallCapsBold text-2xl sm:text-4xl text-brand tracking-wider mb-2 drop-shadow-xl">
        <span class="border-brand px-4 sm:px-8 border-b-2">{data.owner}</span>
      </h1>
      <p class="subtitle font-primary text-lg sm:text-xl" set:html={data.subtitle} />
    </div>
  </header>

  <main>
    <RichTextContainer class="p-4 text-center" content={landingPage.introText} />

    <!-- Team -->
    <TeamList teamMembers={teamMembers} />

    <!-- Angebote -->
    <OfferList offers={offers} />

    <!-- Kontakt -->
    <section class="mb-8">
      <SectionHeader title="Kontakt" id="contact" />
      <Map id="map" data={data} />
      <RichTextContainer class="p-4 text-center" content={landingPage.contactText} />
      <ContactForm />
    </section>

    <!-- Partner -->
    <PartnerList partners={partners} />
  </main>
</Base>
